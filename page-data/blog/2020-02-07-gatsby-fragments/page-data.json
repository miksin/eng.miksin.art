{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/2020-02-07-gatsby-fragments","result":{"data":{"site":{"siteMetadata":{"title":"Miksin","subtitles":["Hello! I am Miksin","I'm a Software Engineer","I'm Painting","I'm Programming","I come from TAIWAN"],"description":"Software Engineer","author":"Miksin","links":[{"name":"Home","path":"/"},{"name":"About","path":"/about"},{"name":"Blog","path":"/blog"},{"name":"Gallery","path":"/gallery"}],"socialLinks":[{"name":"github","link":"https://github.com/miksin"},{"name":"twitter","link":"https://twitter.com/miksin_"},{"name":"instagram","link":"https://www.instagram.com/miksin_/"},{"name":"pixiv","link":"https://pixiv.me/miksin"},{"name":"youtube","link":"https://www.youtube.com/channel/UCmYleBoaTtNtPVZkaUwFxOw"}]}},"page":{"html":"<h2>前言</h2>\n<p>使用 Gatsby.js 來產生靜態網頁非常方便，它的賣點就是可以透過 graphQL 以動態網頁的邏輯來撰寫程式碼。</p>\n<p>不過，graphQL 雖然方便，有時候的確也有些冗長。\n重複出現的部分使用<code class=\"language-text\">fragments</code>就會簡潔許多，這裏簡單介紹如何在 Gatsby 中使用<code class=\"language-text\">fragments</code></p>\n<h2>使用情境</h2>\n<p>這是我在某個 page 裡使用了<code class=\"language-text\">useStaticQuery</code>的片段程式碼，\n我在這個頁面取得了我在<code class=\"language-text\">gatsby-config.js</code>裡定義的一些關於網站的描述。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query SiteTitleQuery {\n    site {\n      siteMetadata {\n        title\n        description\n        author\n        socialLinks {\n          name\n          link\n        }\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>雖然不是很長，但如果我有一些頁面想用同樣的東西，每次都寫一樣的內容會讓程式碼看起來還挺亂的。\n尤其是當這個 graphQL 中還有很多別的需要 query 的內容的時候。</p>\n<h2>定義 fragment</h2>\n<p>我們把 query 中常用到的部分定義成一個一個的<code class=\"language-text\">fragment</code>。</p>\n<p>Gatsby 非常神奇，你可以在任意一個目錄中宣告這些 fragments，它會自動地被搜尋到。\n做個範例，我們現在新增一個檔案<code class=\"language-text\">src/fragments/SiteMetaFragment.js</code>，其內容如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> SiteMetaFragment <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  fragment SiteMetaFragment on Site {\n    siteMetadata {\n      title\n      subtitles\n      description\n      author\n      links {\n        name\n        path\n      }\n      socialLinks {\n        name\n        link\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>然後在我們本來 query 的地方將內容刪掉，換成 fragment 的名字：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query SiteTitleQuery {\n    site {\n      ...SiteMetaFragment\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>可以看到我們就只是 export 了一個變數名，也不知道 export 給誰，沒頭沒腦的宣告。\nBut，<strong>it just works</strong></p>\n<p>這一切就跟原來一樣，Gatsby 順利地找到對應的 fragment 並拿來使用。</p>\n<h2>fragment 的 type</h2>\n<p>大家可能有注意到，在 fragment 的定義的部分我寫上了<code class=\"language-text\">on Site</code>。\n這個部分是代表這個 fragment 在 graphQL 的 type。\n當我取用想這樣 built-in 的 type 時，我怎麼知道他叫什麼名字？</p>\n<p>Gatsby 的開發者介面提供了一個相當方便的 GUI 介面可以查詢。\n在 develop server 啟動時，連進<code class=\"language-text\">localhost:8000/__graphql</code>就可以使用。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/d3ebb/graphql_inspect.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.43147208121827%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACEElEQVQ4y3WUi26jMBBF8/8/uFtpW6nREpK24eEn2IbpXMMgTBJLIzt+HN8743B6f/+gP3/f6H9V0fl8ptvtRhWP67qm+lLnHr+v3LedIuMChZAIbZomatsu92jOOTo1TUNd15HWhkOTUpqGYaBxHHMvY2zG4Z7XrbWUUmLQzPCQgRhj7mSNyZu99wUkxpg3SIx8UClF93uTI8ZE8zzTzMpyv8YJm8wKxc3oEQBKAIhLjLFZoeF9dABtQNjs+361vdiROVyGefRIhTMdxVFne89gGYiDUCgqRek+f1CZ1XPEGF7CMhAKJIcA4CAgsCl2sRFjzZeOg3tpNwPbti0KIQEoKrhVkcFNbzgURd/w4QnUJXYtAwHAIbENVceWUqROW/ru2Y2+UAx+W3tQCCCa5OtoQ4CtMnT+tnRvvmg0NQX3RXHoCmh+2LAluXrVYLlVlp9Mz+O1MBMuTyUQClEIKQpi+RdMRUS+FMCGX8XoOIdTKCxvOUSV5R8CKCzLc5F59J5zi6JUDedZVzQnV8DmtUBZIRTBtgAFhjnpvXekuCiXT03dlSvtfpZKHxUihwKAdRyGKlRbPgr5b2dZmWWVH2z780qu/ce2x0fgojBuucLiMX+Yw0XW8JdI9ZSCKYpRvEPk0HpWGOK64XmVJbf7VuSveNghFIvP3iGAfgXu5/fjDMSXRb64z97hK+C6+rD/FwWtz8x8bo4wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"graphql_inspect.png\"\n        title=\"graphql_inspect.png\"\n        src=\"/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/6ff5e/graphql_inspect.png\"\n        srcset=\"/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/135ae/graphql_inspect.png 300w,\n/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/34e8a/graphql_inspect.png 600w,\n/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/6ff5e/graphql_inspect.png 1200w,\n/static/b5acc5ef5143f14dbcd6cd3a8d6ccdc6/d3ebb/graphql_inspect.png 1576w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>我們輸入<code class=\"language-text\">site</code>後，點擊它便可以看見說明，或是就用右邊的搜尋欄位，就可以發現它的 type 就是<code class=\"language-text\">Site</code>了。</p>\n<h2>總結</h2>\n<p>雖然 fragment 的使用方法官方教學裡就有，但一開始讓我困惑的部分就是 fragment 的「type」是什麼？\n還有我該把這些 fragments 放在哪裡？希望能幫助到也有同樣困擾的人。</p>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/using-graphql-fragments/\">Using GraphQL Fragments</a></li>\n</ul>","frontmatter":{"date":"February 07, 2020","path":"/blog/2020-02-07-gatsby-fragments","title":"在Gatsby.js中使用fragments讓程式碼更簡潔","tags":["graphql","gatsby","react","javascript"]}}},"pageContext":{"next":{"frontmatter":{"path":"/gallery/2020-02-09-genetic","title":"genetic"}},"prev":{"frontmatter":{"path":"/gallery/2020-01-16-hokusai","title":"葛飾北斎"}}}},"staticQueryHashes":["63159454"]}