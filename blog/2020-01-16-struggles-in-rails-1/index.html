<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.26.0"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">學習rails時所遇到的挫折們 - 其一 | Miksin</title><meta data-react-helmet="true" name="description" content="Software Engineer"/><meta data-react-helmet="true" property="og:title" content="學習rails時所遇到的挫折們 - 其一"/><meta data-react-helmet="true" property="og:description" content="Software Engineer"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Miksin"/><meta data-react-helmet="true" name="twitter:title" content="學習rails時所遇到的挫折們 - 其一"/><meta data-react-helmet="true" name="twitter:description" content="Software Engineer"/><style data-styled="" data-styled-version="5.0.0">.elJmwq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.efWXhI{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.eXpeIK{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;}
.jEZhmc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;}
data-styled.g1[id="FlexBox__Wrapper-sc-1a1ax0-0"]{content:"elJmwq,efWXhI,eXpeIK,jEZhmc,"}
.gIVTds{width:100vw;height:100vh;left:0;right:0;top:0;bottom:0;position:fixed;z-index:25;background:linear-gradient(to left,#03a9f4,#03a9f4);-webkit-transform:translateY(-100%);-ms-transform:translateY(-100%);transform:translateY(-100%);-webkit-transition:-webkit-transform 0.25s ease;-webkit-transition:transform 0.25s ease;transition:transform 0.25s ease;}
.gIVTds.active{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}
data-styled.g3[id="ScreenWrapper__Wrapper-lhzvs5-0"]{content:"gIVTds,"}
.hqWhKG{outline:none;border:none;background:transparent;padding:0;margin:0;cursor:pointer;font-size:1rem;padding:5.6000000000000005px;background:transparent;border-radius:50%;}
data-styled.g5[id="IconButton__Btn-sc-1dpa1iz-0"]{content:"hqWhKG,"}
.fACLcD{max-width:480px;width:100%;height:100%;margin:auto;}
data-styled.g6[id="NavMenu__Wrapper-sc-1cinn8h-0"]{content:"fACLcD,"}
.cKrNJE{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:100%;}
data-styled.g7[id="NavMenu__RestPadding-sc-1cinn8h-1"]{content:"cKrNJE,"}
.jnsHJp{margin:auto;padding-top:54px;width:100%;position:relative;}
.jnsHJp.active > div{-webkit-animation-name:dZWjwz;animation-name:dZWjwz;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-timing-function:steps(20,end);animation-timing-function:steps(20,end);-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}
.jnsHJp.active > div:nth-child(1){-webkit-animation-delay:0s;animation-delay:0s;}
.jnsHJp.active > div:nth-child(2){-webkit-animation-delay:0.25s;animation-delay:0.25s;}
.jnsHJp.active > div:nth-child(3){-webkit-animation-delay:0.5s;animation-delay:0.5s;}
.jnsHJp.active > div:nth-child(4){-webkit-animation-delay:0.75s;animation-delay:0.75s;}
data-styled.g8[id="NavMenu__MenuList-sc-1cinn8h-2"]{content:"jnsHJp,"}
.dmjRZp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:0%;overflow:hidden;}
.dmjRZp:hover{background:linear-gradient(to left,transparent,rgba(255,255,255,.2),transparent);}
data-styled.g9[id="NavMenu__MenuItem-sc-1cinn8h-3"]{content:"dmjRZp,"}
.joHSCl{padding:8px 0;margin:auto;text-align:center;font-size:27px;-webkit-text-decoration:none;text-decoration:none;color:#FFFFFF;white-space:nowrap;}
data-styled.g10[id="NavMenu__MenuLink-sc-1cinn8h-4"]{content:"joHSCl,"}
.kpVRSI.active{-webkit-animation-name:hrftdn;animation-name:hrftdn;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-timing-function:cubic-bezier(0,.68,1,.59);animation-timing-function:cubic-bezier(0,.68,1,.59);-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}
data-styled.g11[id="NavMenu__CloseButton-sc-1cinn8h-5"]{content:"kpVRSI,"}
.kkvxxk{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}
data-styled.g12[id="FlexPad-sc-1k4qgli-0"]{content:"kkvxxk,"}
.cpbBhS{position:fixed;width:100%;height:72px;background-color:rgba(255,255,255,0.7);z-index:20;}
@media screen and (max-width:480px){.cpbBhS{height:54px;}}
data-styled.g13[id="Nav__Fixed-sc-11rjgpp-0"]{content:"cpbBhS,"}
.kIujkv{margin:auto;width:100%;height:100%;max-width:1024px;}
data-styled.g14[id="Nav__Wrapper-sc-11rjgpp-1"]{content:"kIujkv,"}
.bxdYXQ{margin:auto 8px;width:54px;height:54px;}
@media screen and (max-width:480px){.bxdYXQ{width:42px;height:42px;}}
data-styled.g15[id="Nav__MenuButton-sc-11rjgpp-2"]{content:"bxdYXQ,"}
.dXLWba{width:100%;height:72px;}
@media screen and (max-width:480px){.dXLWba{height:54px;}}
data-styled.g16[id="TopPad-n3up42-0"]{content:"dXLWba,"}
.laNXhk{background-color:#03a9f4;color:#FFFFFF;padding:4px 10px;border-radius:13px;text-align:center;box-shadow:1px 1px 5px 0px rgba(0,0,0,.3);}
.laNXhk > .name{font-size:18px;line-height:20px;white-space:nowrap;}
.laNXhk > .number{background-color:rgba(66,66,66,0.5);border-radius:10px;font-size:14px;min-width:20px;height:20px;line-height:20px;text-align:center;}
data-styled.g42[id="Tag__Base-suqqo6-0"]{content:"laNXhk,"}
.fZqWod{width:100%;max-width:768px;margin:0 auto;padding:12px;}
data-styled.g88[id="blogTemplate__Wrapper-sc-1iw0vk6-1"]{content:"fZqWod,"}
.dqznRf{width:100%;padding:12px;}
data-styled.g89[id="blogTemplate__Frontmatter-sc-1iw0vk6-2"]{content:"dqznRf,"}
.eJLgoH{width:100%;padding:12px;}
.eJLgoH a{font-weight:700 !important;color:inherit !important;}
data-styled.g92[id="blogTemplate__Content-sc-1iw0vk6-5"]{content:"eJLgoH,"}
.izhIIQ{width:100%;margin:12px auto;border-top:1px solid #424242;}
data-styled.g93[id="blogTemplate__Comment-sc-1iw0vk6-6"]{content:"izhIIQ,"}
@-webkit-keyframes dZWjwz{from{width:0%;}to{width:100%;}}
@keyframes dZWjwz{from{width:0%;}to{width:100%;}}
data-styled.g95[id="sc-keyframes-dZWjwz"]{content:"dZWjwz,"}
@-webkit-keyframes hrftdn{0%{-webkit-transform:rotate(0deg) scale(1) translateY(0);-ms-transform:rotate(0deg) scale(1) translateY(0);transform:rotate(0deg) scale(1) translateY(0);}50%{-webkit-transform:rotate(180deg) scale(0.9) translateY(10%);-ms-transform:rotate(180deg) scale(0.9) translateY(10%);transform:rotate(180deg) scale(0.9) translateY(10%);}100%{-webkit-transform:rotate(360deg) scale(1) translateY(0);-ms-transform:rotate(360deg) scale(1) translateY(0);transform:rotate(360deg) scale(1) translateY(0);}}
@keyframes hrftdn{0%{-webkit-transform:rotate(0deg) scale(1) translateY(0);-ms-transform:rotate(0deg) scale(1) translateY(0);transform:rotate(0deg) scale(1) translateY(0);}50%{-webkit-transform:rotate(180deg) scale(0.9) translateY(10%);-ms-transform:rotate(180deg) scale(0.9) translateY(10%);transform:rotate(180deg) scale(0.9) translateY(10%);}100%{-webkit-transform:rotate(360deg) scale(1) translateY(0);-ms-transform:rotate(360deg) scale(1) translateY(0);transform:rotate(360deg) scale(1) translateY(0);}}
data-styled.g96[id="sc-keyframes-hrftdn"]{content:"hrftdn,"}
</style><link rel="icon" href="/icons/icon-48x48.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#A5CD6C"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e342f90d083b1b3731d53522093d79b6"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e342f90d083b1b3731d53522093d79b6"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-343c385e402c7044f6f4.js"/><link as="script" rel="preload" href="/framework-19dd447402be9c032106.js"/><link as="script" rel="preload" href="/app-947695876b520e8c6c0b.js"/><link as="script" rel="preload" href="/commons-fb0af27078790ad38b98.js"/><link as="script" rel="preload" href="/ed4b0a56400bd545707190e3dd88e5b5598b6a6e-124abe6259510da7f280.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-22201a3aad45f715eef7.js"/><link as="fetch" rel="preload" href="/page-data/blog/2020-01-16-struggles-in-rails-1/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:400,700&amp;display=swap" rel="stylesheet"/><link href="/loader.css" rel="stylesheet"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___loader"><div class="typewriter"><h1 class="text"></h1><h1 class="cursor"></h1></div></div><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div color="rgba(255, 255, 255, 0.7)" class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq Nav__Fixed-sc-11rjgpp-0 cpbBhS" wrap="nowrap" dir="row "><div class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq Nav__Wrapper-sc-11rjgpp-1 kIujkv" wrap="nowrap" dir="row "><div class="FlexPad-sc-1k4qgli-0 kkvxxk"></div><button class="BaseButton-frxe0f-0 IconButton__Btn-sc-1dpa1iz-0 hqWhKG Nav__MenuButton-sc-11rjgpp-2 bxdYXQ"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="#03a9f4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button></div></div><div class="ScreenWrapper__Wrapper-lhzvs5-0 gIVTds"><div class="FlexBox__Wrapper-sc-1a1ax0-0 efWXhI NavMenu__Wrapper-sc-1cinn8h-0 fACLcD" wrap="nowrap" dir="column "><div class="FlexBox__Wrapper-sc-1a1ax0-0 efWXhI NavMenu__MenuList-sc-1cinn8h-2 jnsHJp" wrap="nowrap" dir="column "><div class="FlexBox__Wrapper-sc-1a1ax0-0 eXpeIK NavMenu__MenuItem-sc-1cinn8h-3 dmjRZp" wrap="nowrap" dir="row "><a class="NavMenu__MenuLink-sc-1cinn8h-4 joHSCl" href="/">Home</a></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 eXpeIK NavMenu__MenuItem-sc-1cinn8h-3 dmjRZp" wrap="nowrap" dir="row "><a class="NavMenu__MenuLink-sc-1cinn8h-4 joHSCl" href="/about">About</a></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 eXpeIK NavMenu__MenuItem-sc-1cinn8h-3 dmjRZp" wrap="nowrap" dir="row "><a class="NavMenu__MenuLink-sc-1cinn8h-4 joHSCl" href="/blog">Blog</a></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 eXpeIK NavMenu__MenuItem-sc-1cinn8h-3 dmjRZp" wrap="nowrap" dir="row "><a class="NavMenu__MenuLink-sc-1cinn8h-4 joHSCl" href="/gallery">Gallery</a></div></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq NavMenu__RestPadding-sc-1cinn8h-1 cKrNJE" wrap="nowrap" dir="row "><button class="BaseButton-frxe0f-0 IconButton__Btn-sc-1dpa1iz-0 hqWhKG NavMenu__CloseButton-sc-1cinn8h-5 kpVRSI"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="54" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></button></div></div></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 efWXhI blogTemplate__Base-sc-1iw0vk6-0 juxfqe" wrap="nowrap" dir="column "><div class="TopPad-n3up42-0 dXLWba"></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 efWXhI blogTemplate__Wrapper-sc-1iw0vk6-1 fZqWod" wrap="nowrap" dir="column "><div class="FlexBox__Wrapper-sc-1a1ax0-0 jEZhmc blogTemplate__Frontmatter-sc-1iw0vk6-2 dqznRf" wrap="nowrap" dir="column "><h1 class="blogTemplate__Title-sc-1iw0vk6-3 dCjPls">學習rails時所遇到的挫折們 - 其一</h1><h4 class="blogTemplate__Timestamp-sc-1iw0vk6-4 gbREdv">January 16, 2020</h4><div class="FlexBox__Wrapper-sc-1a1ax0-0 eXpeIK blogTemplate__TagList-sc-1iw0vk6-7 DYKUG" wrap="nowrap" dir="row "><div class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq Tag__Base-suqqo6-0 laNXhk mg-lr-2" color="#FFFFFF" wrap="nowrap" dir="row "><span class="name">ruby</span></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq Tag__Base-suqqo6-0 laNXhk mg-lr-2" color="#FFFFFF" wrap="nowrap" dir="row "><span class="name">rails</span></div><div class="FlexBox__Wrapper-sc-1a1ax0-0 elJmwq Tag__Base-suqqo6-0 laNXhk mg-lr-2" color="#FFFFFF" wrap="nowrap" dir="row "><span class="name">programming</span></div></div></div><div class="blogTemplate__Content-sc-1iw0vk6-5 eJLgoH"><h2>前言</h2>
<p>作為一個 web 框架，rails 曾經紅極一時，直到現在也依然有非常多服務正在使用 rails。
讓我也決定學習使用這個框架，當然在那之前 ruby 也是必須學會的。</p>
<p>我曾學習過很多語言與框架，以我自己的經驗來說，這些觀念都是相同的。
不論從哪個語言開始學習，得到經驗帶到學習新語言時總是能觸類旁通。
恩...直到我遇上了 ruby 跟 rails。</p>
<p>這裏整理了一些我初學 ruby 與 rails 所遇到的挫折們的筆記，
希望也能幫助到同樣入坑的人可能會發生的問題。
至於為什麼標題叫做其一？
因為我覺得我肯定會繼續挫折的。但若沒有出第二集就表示一切順利：）</p>
<h2>ruby 相關</h2>
<p>ruby 是我學習程式之路上遇過最神奇的語言。
許多設計都與主流程式語言截然不同，甚至逆向開車。
但了解其設計原理之後，就覺得也不全無道理。
若能接受它的哲學，其方便之處也是非常多得。</p>
<h3>在 function 名稱中使用符號</h3>
<p>ruby 有個變數命名習慣，就是會某些情形於 function 名中使用<code class="language-text">?</code>與<code class="language-text">!</code>。
這並不是一件奇怪的事，有固定的命名習慣也能幫助他人迅速掌握 function 的內容。</p>
<h4>有 side-effect 的 function 在後面加上<code class="language-text">!</code></h4>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>  <span class="token comment"># 回傳[2, 3, 4]，且原本的陣列內容不變</span>
arr<span class="token punctuation">.</span>map<span class="token operator">!</span> <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token comment"># 回傳[2, 3, 4]，且將陣列內容更新為map後的</span></code></pre></div>
<h4>回傳值為 boolean 的加上<code class="language-text">?</code></h4>
<p>ruby function 名後的<code class="language-text">?</code>，其實就與許多語言中<code class="language-text">isXXX</code>這種命名的意義相同</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>empty<span class="token operator">?</span>        <span class="token comment"># true</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token comment"># false</span></code></pre></div>
<h3>map 的多種寫法</h3>
<p><code class="language-text">map</code>(或其他類似的操作 <code class="language-text">filter</code>, <code class="language-text">each</code>等)
會有多種寫法主要其實是因為 ruby 有特殊的 <code class="language-text">block statement</code> 的設計。
詳情可以參考<a href="https://railsbook.tw/chapters/07-ruby-basic-3.html">這裡</a></p>
<p>使用 block statement 就有兩種寫法：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token comment"># [2, 3, 4]</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token keyword">do</span> <span class="token operator">|</span>x<span class="token operator">|</span>        <span class="token comment"># [2, 3, 4]</span>
  x <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">end</span></code></pre></div>
<p>在某些狀況可以使用 <code class="language-text">&amp;</code> 可以讓程式碼更簡潔些：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token symbol">:upcase</span><span class="token punctuation">)</span> <span class="token comment"># ["A", "B", "C"]</span></code></pre></div>
<p>這是使用了<code class="language-text">Symbol</code>的<code class="language-text">to_proc</code>方法的語法糖，詳細可參考
<a href="https://qiita.com/k-penguin-sato/items/420d7487b28b5d58cac4">這裡</a>。</p>
<p>因此這種寫法其實也可以寫成這樣：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> <span class="token symbol">:upcase</span><span class="token punctuation">.</span>to_proc<span class="token punctuation">.</span>call<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment"># ["A", "B", "C"]</span></code></pre></div>
<p>根據不同狀況有語法糖是不錯，只是達成同一個目的有太多種作法容易造成混淆也是困擾的地方呢。</p>
<h3>function 呼叫的各種省略</h3>
<p>這是我閱讀一個專案中的 ruby 程式碼時少數會讓我有點「生氣」的設計。
就是 ruby 中的 function 呼叫可以省略小括號，在某些條件下也能省略參數用的大括號。</p>
<p>我們先來看一個在 rails 中常見的寫法：
(<a href="https://railsbook.tw/chapters/07-ruby-basic-3.html">參考來源</a>)</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> link_to <span class="token string">'刪除'</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> method<span class="token punctuation">:</span> <span class="token symbol">:delete</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> confirm<span class="token punctuation">:</span> <span class="token string">'sure?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'btn'</span> <span class="token operator">%</span><span class="token operator">></span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 728px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0b130d3249d05970663d9e740343e3f3/e2ef7/confused.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.0934065934066%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB6Fq01E0H/8QAGxAAAgIDAQAAAAAAAAAAAAAAAgMAEQESIgT/2gAIAQEAAQUCZZL83Mbe4DATplg9f//EABYRAQEBAAAAAAAAAAAAAAAAAAARIf/aAAgBAwEBPwHFf//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAaEAACAgMAAAAAAAAAAAAAAAAAEQIxARDB/9oACAEBAAY/ApcMxjpuxss//8QAGhAAAwEBAQEAAAAAAAAAAAAAAAERIUFRYf/aAAgBAQABPyFo7j6GtDGrrGpXH8OeGm4Ibd+Lwrdaf//aAAwDAQACAAMAAAAQrA//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QUCQMv//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8QBcl72//EABsQAQEBAAIDAAAAAAAAAAAAAAERACExcaHR/9oACAEBAAE/EKXshSMIPimSeyREpx383ekBRcXOEQXK8hFonQDWpoGet//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="這是殺小？.jpg"
        title="這是殺小？.jpg"
        src="/static/0b130d3249d05970663d9e740343e3f3/e2ef7/confused.jpg"
        srcset="/static/0b130d3249d05970663d9e740343e3f3/afcd2/confused.jpg 300w,
/static/0b130d3249d05970663d9e740343e3f3/82472/confused.jpg 600w,
/static/0b130d3249d05970663d9e740343e3f3/e2ef7/confused.jpg 728w"
        sizes="(max-width: 728px) 100vw, 728px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>要說這是一個 function 呼叫實在令人難以接受。
從表面來看甚至無法得知從哪邊開始是參數，有幾個參數，到哪邊為止都還算 call function 的一部份？</p>
<p>這裏要先看第一個省略：省略 call function 時的小括號</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">hello</span></span>
  puts <span class="token string">'hello!'</span>
<span class="token keyword">end</span>

hello <span class="token comment"># 只要這樣寫就算call function</span></code></pre></div>
<p>對我來說最不能接受的就是這個設計，這會直接影響到對程式碼行為的判讀。
我光看片段程式碼根本不知道這到底是變數還是 function 執行後的結果，嚴重降低維護與 review 效率。</p>
<p>不過既然語言這樣設計也只能接受，因此上面的<code class="language-text">link_to</code>即是呼叫 rails 中這個名稱的 function。</p>
<p>接下來是參數的數量，在 link<em>to 的範例裡可以看到被逗號隔開的項目有五個，但這裡其實並不是五個參數。
<code class="language-text">method: :delete</code>並不是代表`link</em>to<code class="language-text">裡面有一個叫做</code>method<code class="language-text">的參數名，</code>method: :delete, data: { confirm: 'sure?' }, class: 'btn'`是<strong>一個參數</strong></p>
<p>這是 ruby 的一個神秘設計，當 function 最後一個參數是 hash 時，它的大括號可以省略。
因此這個例子我們不要省略東西看起來是這個樣子的：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> link_to<span class="token punctuation">(</span><span class="token string">'刪除'</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> <span class="token punctuation">{</span>method<span class="token punctuation">:</span> <span class="token symbol">:delete</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> confirm<span class="token punctuation">:</span> <span class="token string">'sure?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">'btn'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>`</code></pre></div>
<p>好，我們現在知道 function 呼叫用的小括號可以省略了，
但是這裡有個嚴重的問題來了，如果我就是沒有要呼叫，而是要做其他操作例如當變數傳遞時怎麼辦？</p>
<p>我們可以使用<code class="language-text">method</code>這個 function，將它轉換為另一個物件來傳遞，
然後在需要呼叫時使用該物件的<code class="language-text">call</code>方法來呼叫，比方說我們有一個 function：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">hello</span></span>
  puts <span class="token string">'hello!'</span>
<span class="token keyword">end</span>

h <span class="token operator">=</span> method<span class="token punctuation">(</span><span class="token symbol">:hello</span><span class="token punctuation">)</span>
h<span class="token punctuation">.</span>call <span class="token comment"># hello!</span></code></pre></div>
<p>或是，恩，用剛學到的省略括號的方式：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">h <span class="token operator">=</span> method <span class="token symbol">:hello</span>
h<span class="token punctuation">.</span>call <span class="token comment"># hello!</span></code></pre></div>
<h4>Ruby 2.0 新增的 Keyword Arguments 一同使用</h4>
<h3>覆寫 built-in class</h3>
<p>這是源自於 ruby 的一個特色：Open Class, 重複宣告的 class 會互相融合。
且成員衝突時，後宣告的會覆寫前面宣告的。
這個設計甚至對 built-in class 也有用！</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token string">"hello"</span><span class="token punctuation">.</span>size <span class="token comment"># 5</span>

<span class="token keyword">class</span> <span class="token class-name">String</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">size</span></span>
    <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token string">"hello"</span><span class="token punctuation">.</span>size <span class="token comment"># 1</span></code></pre></div>
<p>可以看到我們成功覆寫了 string 中 size 的定義，讓其不管長度多少都只會回傳 1。</p>
<p>這是個在很多情況會讓人很困擾的設計，但或許 ruby 是想讓使用者在使用上更有彈性些吧。
豬隊友就不是語言能防的了。</p>
<h2>rails 相關</h2>
<p>這部分多半是源於閱讀一個 rails 專案程式碼時時常產生的疑惑：rails 到底幫我做了多少事？
rails 的方便之處就在於只要遵照慣例，就能以少量的程式碼快速產生一個網站所需的功能。
但如果對 rails 熟悉度不夠，在維護現存程式碼時就倍加困難，
因為不清楚哪些沒寫出來的部分是由 rails 擅自完成的。</p>
<h3>model 中依據 enum 所產生的 functions</h3>
<p>有時候我們在 Relational Database 的設計中，會有類似 <em>status</em> 這樣的 attribute。
如果使用 string 來儲存雖然可以讓人也能看懂在 db 中的 record，但無疑會影響效能。
因此在很多設計中會改以整數來儲存，並在 orm 中搭配使用 enum 來幫助維護。</p>
<p>比方說現在有個 table 叫做<code class="language-text">Article</code>，我們用<code class="language-text">status</code>來代表這個文章現在的狀態。</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  enum status<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:draft</span><span class="token punctuation">,</span> <span class="token symbol">:scheduled</span><span class="token punctuation">,</span> <span class="token symbol">:published</span><span class="token punctuation">]</span>
<span class="token keyword">end</span></code></pre></div>
<p>我們用 enum 分別代表草稿，預約公開與已公開三種狀態。
而這時 rails 會自動幫我們分別為這三種狀態產生 boolean functions：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">article <span class="token operator">=</span> <span class="token constant">Article</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token symbol">:draft</span><span class="token punctuation">)</span>
article<span class="token punctuation">.</span>status <span class="token comment"># draft</span>

article<span class="token punctuation">.</span>draft<span class="token operator">?</span>     <span class="token comment"># true</span>
article<span class="token punctuation">.</span>scheduled<span class="token operator">?</span> <span class="token comment"># false</span>
article<span class="token punctuation">.</span>published<span class="token operator">?</span> <span class="token comment"># false</span></code></pre></div>
<p>喔喔！這聽起來挺方便的，
變成可以使用 enum 的值並在後面加上問號來確認現在是不是這個狀態。</p>
<p>除了問號之外 rails 也使用驚嘆號分別產生的對應的 function：</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">article<span class="token punctuation">.</span>draft<span class="token operator">!</span>     <span class="token comment"># 將status改成draft</span>
article<span class="token punctuation">.</span>scheduled<span class="token operator">!</span> <span class="token comment"># 將status改成scheduled</span>
article<span class="token punctuation">.</span>published<span class="token operator">!</span> <span class="token comment"># 將status改成published</span></code></pre></div>
<p>還記得前面提到的命名慣例嗎？
驚嘆號代表有 side-effect 的 function。
這幾個 function 會直接修改 model 的內容。</p>
<h2>References</h2>
<p>ruby/rails 的日本使用者較多，有些參考連結是日文的請見諒 :)</p>
<ul>
<li><a href="https://qiita.com/k-penguin-sato/items/420d7487b28b5d58cac4">【Ruby】array.map(&#x26;:method)を理解する</a></li>
<li><a href="https://railsbook.tw/chapters/07-ruby-basic-3.html">方法與程式碼區塊（block）</a></li>
<li><a href="https://codingbee.net/ruby/ruby-open-classes-and-monkey-patching">Ruby – Open Classes and Monkey Patching</a></li>
<li><a href="https://thoughtbot.com/blog/ruby-2-keyword-arguments">Ruby 2 Keyword Arguments</a></li>
<li><a href="https://www.justinweiss.com/articles/fun-with-keyword-arguments/">Fun With Keyword Arguments, Hashes, and Splats</a></li>
<li><a href="https://qiita.com/shizuma/items/d133b18f8093df1e9b70">Rails enum についてまとめておく</a></li>
</ul></div><div class="blogTemplate__Comment-sc-1iw0vk6-6 izhIIQ"><span class="disqus-comment-count" data-disqus-identifier="/blog/2020-01-16-struggles-in-rails-1">...</span><div id="disqus_thread"></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-XXXXXXXXX-X', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020-01-16-struggles-in-rails-1";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f5ec1ff06108d0c85bab.js"],"app":["/app-947695876b520e8c6c0b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c5713cc239e7114fe6a5.js"],"component---src-pages-about-js":["/component---src-pages-about-js-ab7d22cbce5c07282227.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-221cc1b29321015c84d5.js"],"component---src-pages-gallery-js":["/component---src-pages-gallery-js-35e56239d7cc57de772d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-cc98d27e2bf892d1a27d.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-22201a3aad45f715eef7.js"]};/*]]>*/</script><script src="/polyfill-f5ec1ff06108d0c85bab.js" nomodule=""></script><script src="/component---src-templates-blog-template-js-22201a3aad45f715eef7.js" async=""></script><script src="/ed4b0a56400bd545707190e3dd88e5b5598b6a6e-124abe6259510da7f280.js" async=""></script><script src="/commons-fb0af27078790ad38b98.js" async=""></script><script src="/app-947695876b520e8c6c0b.js" async=""></script><script src="/framework-19dd447402be9c032106.js" async=""></script><script src="/webpack-runtime-343c385e402c7044f6f4.js" async=""></script></body></html>